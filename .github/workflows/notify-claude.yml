name: ðŸ¤– Notify Claude on Code Update

# KÃ­ch hoáº¡t khi cÃ³ push code
on:
  push:
    branches:
      - main
    paths:
      - 'code.gs'
      - '**.html'
  
  # Cho phÃ©p cháº¡y thá»§ cÃ´ng
  workflow_dispatch:

jobs:
  notify-claude:
    runs-on: ubuntu-latest
    
    steps:
      # BÆ°á»›c 1: Táº£i code vá»
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      # BÆ°á»›c 2: Láº¥y thÃ´ng tin thay Ä‘á»•i
      - name: ðŸ“Š Get Changes Info
        id: changes
        run: |
          # Láº¥y commit message
          COMMIT_MSG=$(git log -1 --pretty=%B)
          echo "commit_message=$COMMIT_MSG" >> $GITHUB_OUTPUT
          
          # Láº¥y ngÆ°á»i commit
          AUTHOR=$(git log -1 --pretty=%an)
          echo "author=$AUTHOR" >> $GITHUB_OUTPUT
          
          # Láº¥y timestamp
          TIMESTAMP=$(git log -1 --pretty=%cI)
          echo "timestamp=$TIMESTAMP" >> $GITHUB_OUTPUT
          
          # Äáº¿m sá»‘ dÃ²ng thay Ä‘á»•i
          CHANGES=$(git diff HEAD^ HEAD --stat | tail -1)
          echo "stats=$CHANGES" >> $GITHUB_OUTPUT
          
          # Láº¥y danh sÃ¡ch file thay Ä‘á»•i
          FILES=$(git diff --name-only HEAD^ HEAD)
          echo "files<<EOF" >> $GITHUB_OUTPUT
          echo "$FILES" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      # BÆ°á»›c 3: Táº¡o summary bÃ¡o cÃ¡o
      - name: ðŸ“ Create Summary
        run: |
          echo "## ðŸ”” Code Updated!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Commit:** ${{ steps.changes.outputs.commit_message }}" >> $GITHUB_STEP_SUMMARY
          echo "**Author:** ${{ steps.changes.outputs.author }}" >> $GITHUB_STEP_SUMMARY
          echo "**Time:** ${{ steps.changes.outputs.timestamp }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Changes:** ${{ steps.changes.outputs.stats }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Modified Files:**" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.changes.outputs.files }}" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY

      # BÆ°á»›c 4: ThÃ´ng bÃ¡o hoÃ n thÃ nh
      - name: âœ… Done
        run: |
          echo "âœ… Workflow completed successfully"
          echo "ðŸ“… Timestamp: ${{ steps.changes.outputs.timestamp }}"
