<v-tabs-items v-model="activeTab" class="fill-height">
<v-tab-item><div id="anchor-transfer-content" class="split-container"><div class="pane-left elevation-1"><div class="d-flex align-center justify-space-between mb-2 toolbar-height-fix"><div class="subtitle-2 grey--text text--darken-3 font-weight-bold">RAW DATA</div><div class="d-flex"><v-btn color="cyan darken-3" small dark class="mr-2 font-weight-bold" @click="analyzeTransfer"><v-icon left small>mdi-google-analytics</v-icon> Ph?n T?ch</v-btn><v-btn v-if="parsedTransferData.length &gt; 0" color="blue darken-3" small dark class="font-weight-bold" @click="requestSaveTransfer"><v-icon left small>mdi-content-save-check</v-icon> L?u</v-btn></div></div><textarea v-model.lazy="rawTransferInput" placeholder="Paste: 5.12 Qu?nh IN..." class="native-textarea flex-grow-1" spellcheck="false" @input="autoResize"></textarea></div><div class="pane-right table-container-fixed" style="height: 100%;"><v-data-table :headers="headersTransfer" :items="parsedTransferData" fixed-header height="calc(100vh - 215px)" :items-per-page="50" class="elevation-0" :item-class="rowClassTransfer"><template v-slot:item.actions_left="{ item }"><v-btn icon small color="blue darken-2" @click="openEditDialog(item, 'ML_TRANS')"><v-icon small>mdi-pencil-circle</v-icon></v-btn></template><template v-slot:item.staff="{ item }"><span>{{ item.sender }} <v-icon x-small v-if="item.receiver">mdi-arrow-right</v-icon> {{ item.receiver }}</span></template><template v-slot:item.type="{ item }"><v-chip label x-small :color="item.type === 'IN' ? 'green lighten-5' : 'deep-orange lighten-5'" :class="item.type === 'IN' ? 'green--text text--darken-3' : 'deep-orange--text text--darken-3'" class="font-weight-black">{{ item.type }}</v-chip></template><template v-slot:item.rate="{ item }"><div v-if="item.rate &gt; 1" class="d-flex align-center justify-center"><v-chip x-small label class="px-1 mr-1" :color="item.rateState === 1 ? 'green lighten-4' : 'grey lighten-4'" :class="{'green--text text--darken-4 font-weight-black': item.rateState === 1, 'grey--text': item.rateState !== 1}" style="border: 1px solid #C8E6C9; cursor: pointer;" @click="setRateMode(item, 1)">x</v-chip><span class="caption font-weight-bold grey--text text--darken-2" style="min-width: 20px; text-align: center;">{{ item.rate }}</span><v-chip x-small label class="px-1 ml-1" :color="item.rateState === 2 ? 'deep-orange lighten-4' : 'grey lighten-4'" :class="{'deep-orange--text text--darken-4 font-weight-black': item.rateState === 2, 'grey--text': item.rateState !== 2}" style="border: 1px solid #FFCCBC; cursor: pointer;" @click="setRateMode(item, 2)">/</v-chip></div><span v-else class="grey--text lighten-2" style="font-size: 20px;">&mdash;</span></template><template v-slot:item.qty="{ item }"><v-edit-dialog :return-value.sync="item.qty" @save="syncOriginalQty(item)"><span class="font-weight-black blue--text text--darken-2" style="font-size:16px">{{ formatNumber(item.qty) }}</span><template v-slot:input><v-text-field v-model="item.qty" type="number" single-line></v-text-field></template></v-edit-dialog></template><template v-slot:item.unit="{ item }"><v-chip label small @click="toggleUnitAnalysis(item)" :color="item.unit===item.standardUnit?'teal lighten-4':'grey lighten-4'" :class="item.unit===item.standardUnit?'teal--text text--darken-4':'black--text'" class="font-weight-bold" style="cursor:pointer;min-width:50px;justify-content:center">{{ item.unit }}</v-chip></template><template v-slot:item.code="{ item }"><span v-if="item.code" class="code-text" style="font-size:16px">{{ item.code }}</span><span v-else class="grey--text text--lighten-1" style="font-size: 20px;">&mdash;</span></template><template v-slot:item.name="{ item }"><div class="text-analyzed" style="font-size:16px">{{ item.name }}</div><div class="text-sub">G?c: {{ item.originalKeyword }}</div></template><template v-slot:item.team="{ item }"><v-select v-model="item.team" :items="['Kitchen', 'Pizza', 'Service', 'Bar']" dense hide-details class="caption mt-0 pt-0 font-weight-bold" style="font-size: 13px;"></v-select></template><template v-slot:item.actions="{ item }"><v-btn icon small color="red lighten-1" @click="deleteTransferRow(item)"><v-icon small>mdi-delete</v-icon></v-btn></template></v-data-table></div></div></v-tab-item>

<v-tab-item><div id="anchor-spoilage-content" class="split-container"><div class="pane-left elevation-1"><v-row dense class="mb-2" style="flex: 0 0 auto;"><v-col cols="6"><v-text-field v-model="spoilageDate" label="Ng?y H?y" type="date" outlined dense hide-details class="font-weight-bold"></v-text-field></v-col><v-col cols="6"><v-select v-model="spoilageDept" :items="['Kitchen','Pizza','Service']" label="B? Ph?n" outlined dense hide-details class="font-weight-bold"></v-select></v-col></v-row><div class="d-flex align-center justify-space-between mb-2 toolbar-height-fix"><div class="subtitle-2 grey--text text--darken-3 font-weight-bold">NH?P LI?U</div><div class="d-flex"><v-btn color="deep-orange darken-3" small dark class="mr-2" @click="analyzeSpoilage">Ph?n T?ch</v-btn><v-btn v-if="parsedSpoilageData.length &gt; 0" color="blue darken-3" small dark class="font-weight-bold" @click="requestSaveSpoilage">L?u</v-btn></div></div><div class="spoilage-input-container"><div class="d-flex flex-column" style="width: 50%;"><div class="caption font-weight-bold deep-orange--text mb-1">NVL / SEMI</div><textarea v-model.lazy="rawSpoilageInputNVL" placeholder="Paste NVL..." class="native-textarea full-height-input flex-grow-1" spellcheck="false" @input="autoResize"></textarea></div><div class="d-flex flex-column" style="width: 50%;"><div class="caption font-weight-bold blue--text mb-1">PRODUCT</div><textarea v-model.lazy="rawSpoilageInputProduct" placeholder="Paste Product..." class="native-textarea full-height-input flex-grow-1" spellcheck="false" @input="autoResize"></textarea></div></div></div><div class="pane-right"><div class="dual-table-container"><div class="half-table table-container-fixed" style="height: 100%"><v-data-table :headers="headersSpoilage" :items="splitSpoilageData.left" disable-pagination hide-default-footer class="elevation-0" fixed-header height="100%" :item-class="rowClassSpoilage"><template v-slot:item.actions_left="{ item }"><v-btn icon color="blue darken-2" small @click="handleSpoilageRowDbClick(null, {item})"><v-icon small>mdi-pencil-circle</v-icon></v-btn></template><template v-slot:item.qty="{ item }"><v-edit-dialog :return-value.sync="item.qty"><span class="font-weight-bold">{{ formatNumber(item.qty) }}</span><template v-slot:input><v-text-field v-model="item.qty" type="number" single-line></v-text-field></template></v-edit-dialog></template><template v-slot:item.code="{ item }"><span class="code-text" v-if="item.code">{{ item.code }}</span></template><template v-slot:item.name="{ item }"><div class="text-analyzed text-truncate" style="max-width: 200px;">{{ item.name }}</div><div class="text-sub text-truncate" style="max-width: 180px;">{{ item.originalKeyword }} <span v-if="item.note" class="red--text ml-1">| {{ item.note }}</span></div></template><template v-slot:item.actions="{ item }"><v-btn icon small color="red lighten-2" @click="deleteRow(item)"><v-icon small>mdi-close</v-icon></v-btn></template></v-data-table></div><div class="half-table table-container-fixed" style="height: 100%"><v-data-table :headers="headersSpoilage" :items="splitSpoilageData.right" disable-pagination hide-default-footer class="elevation-0" fixed-header height="100%" :item-class="rowClassSpoilage"><template v-slot:item.qty="{ item }"><v-edit-dialog :return-value.sync="item.qty"><span class="font-weight-bold">{{ formatNumber(item.qty) }}</span><template v-slot:input><v-text-field v-model="item.qty" type="number" single-line></v-text-field></template></v-edit-dialog></template><template v-slot:item.code="{ item }"><span class="code-text" v-if="item.code">{{ item.code }}</span></template><template v-slot:item.name="{ item }"><div class="text-analyzed text-truncate" style="max-width: 200px;">{{ item.name }}</div><div class="text-sub text-truncate" style="max-width: 180px;">{{ item.originalKeyword }} <span v-if="item.note" class="red--text ml-1">| {{ item.note }}</span></div></template><template v-slot:item.actions="{ item }"><v-btn icon small color="red lighten-2" @click="deleteRow(item)"><v-icon small>mdi-close</v-icon></v-btn></template></v-data-table></div></div><div class="custom-footer"><span class="subtitle-2 font-weight-bold blue-grey--text text--darken-3">T?ng d?ng: {{ parsedSpoilageData.length }}</span><div class="d-flex align-center"><v-btn icon small @click="page &gt; 1 ? page-- : null" :disabled="page === 1"><v-icon>mdi-chevron-left</v-icon></v-btn><span class="mx-2 font-weight-bold">{{ page }} / {{ pageCount }}</span><v-btn icon small @click="page &lt; pageCount ? page&#43;&#43; : null" :disabled="page === pageCount"><v-icon>mdi-chevron-right</v-icon></v-btn></div></div></div></div></v-tab-item>

<v-tab-item>
    <div class="d-flex flex-column" style="height: 100%; background: #F5F5F5;">
        
        
        <div class="d-flex align-center pa-3 elevation-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); z-index: 10; height: 80px; flex-shrink: 0; border-bottom: 3px solid #FFD600;">
            
            
            <v-menu v-model="menuSpoilageDate" :close-on-content-click="false">
                <template v-slot:activator="{ on, attrs }">
                    <v-text-field v-model="spoilageDate" label="? Th?ng" prepend-icon="mdi-calendar-month" readonly v-bind="attrs" v-on="on" dense outlined hide-details dark class="mr-3 font-weight-bold" style="max-width: 190px; background: rgba(255,255,255,0.2); border-radius: 8px;"></v-text-field>
                </template>
                <v-date-picker v-model="spoilageDate" type="month" @input="menuSpoilageDate = false" no-title locale="vi-VN" color="deep-purple darken-2"></v-date-picker>
            </v-menu>

            
            <v-btn color="white" dark class="mr-3 font-weight-black elevation-4" style="background: linear-gradient(45deg, #00BCD4, #00E5FF); height: 52px;" @click="getSpoilageHistory">
                <v-icon left>mdi-cloud-download</v-icon> T?I
            </v-btn>

            
            <v-btn-toggle v-model="filterSpoilageTeam" dense class="mr-3 elevation-2" style="background: white; border-radius: 8px;">
                <v-btn :value="null" small class="font-weight-bold px-3" style="height: 52px;">T?T C?</v-btn>
                <v-btn value="Kitchen" small class="font-weight-bold teal--text px-3" style="height: 52px;">? B?P</v-btn>
                <v-btn value="Pizza" small class="font-weight-bold deep-orange--text px-3" style="height: 52px;">? PZZ</v-btn>
                <v-btn value="Service" small class="font-weight-bold blue--text px-3" style="height: 52px;">?? SVC</v-btn>
                <v-btn value="Bar" small class="font-weight-bold purple--text px-3" style="height: 52px;">? BAR</v-btn>
            </v-btn-toggle>

            <v-spacer></v-spacer>

            
            <v-btn :color="spoilageDisplayMode === 'ORIGINAL' ? 'blue-grey darken-2' : 'teal darken-2'" dark depressed class="font-weight-black elevation-3 mr-3" style="height: 52px;" @click="toggleAllUnits">
                <v-icon left small>mdi-swap-horizontal</v-icon>
                {{ spoilageDisplayMode === 'ORIGINAL' ? '?VT G?C' : '?VT QUY ??I' }}
            </v-btn>

            
            <v-btn :color="dashboardMode === 'QTY' ? 'deep-orange darken-2' : 'green darken-2'" dark depressed class="font-weight-black elevation-3 mr-3" style="height: 52px; min-width: 160px;" @click="quickToggleMode">
                <v-icon left>{{ dashboardMode === 'QTY' ? 'mdi-package-variant' : 'mdi-currency-usd' }}</v-icon>
                {{ dashboardMode === 'QTY' ? 'S? L??NG' : 'TI?N' }}
            </v-btn>

            
          <v-btn 
    color="green darken-3" 
    dark 
    depressed 
    class="font-weight-black elevation-4" 
    style="height: 52px;" 
    @click="openExportDialog"
>
    <v-icon left>mdi-microsoft-excel</v-icon> XU?T EXCEL
</v-btn>
        </div>
        
        <div class="d-flex flex-row pa-3" style="height: 220px; gap: 16px; background: #ECEFF1; flex-shrink: 0;" v-if="spoilageHistory.length &gt; 0">
            
            
            <div class="glass-card flex-grow-1 elevation-6 pa-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; position: relative; overflow: hidden;">
                <div style="position: absolute; top: -50px; right: -50px; font-size: 180px; opacity: 0.06;">?</div>
                <div style="font-size: 12px; opacity: 0.9; letter-spacing: 2px; margin-bottom: 10px; text-transform: uppercase; font-weight: 600;">T?NG TH?T THO?T</div>
                <div style="font-size: 48px; font-weight: 900; text-shadow: 0 4px 12px rgba(0,0,0,0.5); line-height: 1; margin-bottom: 12px;">
                    {{ formatNumber(spoilageStats.totalVal) }}
                    <span style="font-size: 22px; opacity: 0.9; margin-left: 12px;">{{ spoilageStats.unitLabel }}</span>
                </div>
                <div style="font-size: 15px; opacity: 0.85; margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                    <span>? {{ spoilageStats.totalCount }} phi?u</span>
                    <span v-if="filterSpoilageTeam" style="background: rgba(255,255,255,0.25); padding: 4px 10px; border-radius: 6px; font-weight: 700;">
                        L?c: {{ filterSpoilageTeam }}
                    </span>
                </div>
                <v-tooltip bottom color="error" v-if="spoilageStats.hasZeroCost &amp;&amp; dashboardMode === 'AMT'">
                    <template v-slot:activator="{ on, attrs }">
                        <v-icon color="yellow accent-2" v-bind="attrs" v-on="on" class="blink-animation" style="position: absolute; top: 24px; right: 24px; font-size: 36px;">mdi-alert-circle</v-icon>
                    </template>
                    <span class="font-weight-bold" style="font-size: 15px;">?? C? M?N GI? 0?!</span>
                </v-tooltip>
            </div>

            
            <div class="glass-card flex-grow-1 elevation-6 pa-4" style="background: white; border-radius: 16px;">
                <div class="subtitle-1 blue-grey--text text--darken-3 font-weight-black mb-3" style="font-size: 13px; letter-spacing: 1px; text-transform: uppercase;">NVL / SEMI / PRODUCT</div>
                <div class="d-flex justify-space-around align-center" style="height: calc(100% - 40px);">
                    
                    
                    <div class="text-center">
                        <div class="caption grey--text text--darken-1 mb-2" style="font-size: 11px; font-weight: 600;">? NVL</div>
                        <div class="display-1 font-weight-black teal--text text--darken-3" style="font-size: 32px; line-height: 1;">{{ formatNumber(spoilageStats.byType.NVL) }}</div>
                        <div class="caption grey--text mt-2" style="font-size: 14px; font-weight: 700;">
                            {{ Math.round((spoilageStats.byType.NVL / spoilageStats.totalVal) * 100) || 0 }}%
                        </div>
                    </div>
                    
                    <v-divider vertical class="mx-2"></v-divider>
                    
                    
                    <div class="text-center">
                        <div class="caption grey--text text--darken-1 mb-2" style="font-size: 11px; font-weight: 600;">? SEMI</div>
                        <div class="display-1 font-weight-black deep-orange--text text--darken-3" style="font-size: 32px; line-height: 1;">{{ formatNumber(spoilageStats.byType.SEMI) }}</div>
                        <div class="caption grey--text mt-2" style="font-size: 14px; font-weight: 700;">
                            {{ Math.round((spoilageStats.byType.SEMI / spoilageStats.totalVal) * 100) || 0 }}%
                        </div>
                    </div>
                    
                    <v-divider vertical class="mx-2"></v-divider>
                    
                    
                    <div class="text-center">
                        <div class="caption grey--text text--darken-1 mb-2" style="font-size: 11px; font-weight: 600;">? PROD</div>
                        <div class="display-1 font-weight-black blue--text text--darken-3" style="font-size: 32px; line-height: 1;">{{ formatNumber(spoilageStats.byType.PROD) }}</div>
                        <div class="caption grey--text mt-2" style="font-size: 14px; font-weight: 700;">
                            {{ Math.round((spoilageStats.byType.PROD / spoilageStats.totalVal) * 100) || 0 }}%
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="glass-card flex-grow-1 elevation-6 pa-4" style="background: white; border-radius: 16px;">
                <div class="subtitle-1 blue-grey--text text--darken-3 font-weight-black mb-3" style="font-size: 13px; letter-spacing: 1px; text-transform: uppercase;">? L? DO H?Y</div>
                <div style="height: calc(100% - 40px); display: flex; flex-direction: column; justify-content: space-around;">
                    <div v-for="(r, i) in spoilageStats.byReason" :key="i" class="d-flex justify-between align-center mb-2">
                        <div class="caption grey--text text--darken-3 font-weight-bold" style="font-size: 13px; max-width: 140px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            {{ i + 1 }}. {{ r.reason }}
                        </div>
                        <div class="d-flex align-items-baseline">
                            <span class="subtitle-1 font-weight-black blue-grey--text text--darken-4" style="font-size: 18px;">{{ formatNumber(r.val) }}</span>
                            <span class="caption grey--text ml-2" style="font-size: 12px; font-weight: 600;">({{ Math.round((r.val / spoilageStats.totalVal) * 100) }}%)</span>
                        </div>
                    </div>
                    <div v-if="spoilageStats.byReason.length === 0" class="text-center grey--text" style="font-size: 13px;">Kh?ng c? d? li?u</div>
                </div>
            </div>

            
            <div class="glass-card flex-grow-1 elevation-6 pa-4" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border-radius: 16px; position: relative; overflow: hidden;">
                <div style="position: absolute; bottom: -60px; right: -60px; font-size: 200px; opacity: 0.08;">?</div>
                <div style="font-size: 12px; opacity: 0.95; letter-spacing: 2px; margin-bottom: 10px; text-transform: uppercase; font-weight: 600;">?? TOP 3 R?I RO</div>
                <div style="height: calc(100% - 40px); display: flex; flex-direction: column; justify-content: space-around;">
    <div v-for="(item, i) in spoilageStats.top3Items" :key="i" class="mb-2">
        <div style="font-size: 14px; line-height: 1.3; font-weight: 700; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
            {{ i + 1 }}. {{ item.name }}
        </div>
        <div style="font-size: 20px; font-weight: 900; color: #FFEB3B; text-shadow: 0 2px 6px rgba(0,0,0,0.4);">
            {{ formatNumber(item.val) }} {{ spoilageStats.unitLabel }}
        </div>
    </div>
    <div v-if="spoilageStats.top3Items.length === 0" class="text-center" style="font-size: 14px; opacity: 0.8;">Kh?ng c? d? li?u</div>
</div>
            </div>

        </div>
        
        <div style="flex-grow: 1; overflow: hidden; background: white; padding: 16px;">
            <v-data-table 
                :headers="headersSpoilageHistory" 
                :items="displayedSpoilageHistory" 
                fixed-header 
                height="calc(100vh - 430px)"
                class="elevation-2 spoilage-table" 
                :items-per-page="100"
                dense
                :footer-props="{'items-per-page-options': [50, 100, 200, -1]}"
                @click:row="handleSpoilageRowClick"
                style="cursor: pointer;"
            >
                
                <template v-slot:item.date="{ item }">
                    <span class="font-weight-bold grey--text text--darken-4" style="font-size: 16px;">{{ item.date.split('/').slice(0,2).join('/') }}</span>
                </template>
                
                
<template v-slot:item.code="{ item }">
    <div class="d-flex align-items-center">
        <span class="code-text blue--text text--darken-2 font-weight-black mr-2" style="font-size: 17px;">{{ item.code }}</span>
        <v-tooltip bottom v-if="item.type === 'SEMI' || item.type === 'PROD'">
            <template v-slot:activator="{ on, attrs }">
                <v-icon small color="deep-purple darken-2" v-bind="attrs" v-on="on">mdi-radar</v-icon>
            </template>
            <span>Click ?? xem Xray BOM h?y</span>
        </v-tooltip>
    </div>
</template>
                
                
                <template v-slot:item.name="{ item }">
                    <div class="font-weight-bold black--text" style="font-size: 17px;">{{ item.name }}</div>
                </template>
                
                
<template v-slot:item.qty="{ item }">
    <div class="text-right">
        <span class="font-weight-black blue--text text--darken-3" style="font-size: 20px;">
            {{ formatQtyDisplay(item._displayQty) }}
        </span>
        <span class="caption grey--text text--darken-1 ml-1" style="font-size: 14px;">{{ item._displayUnit }}</span>
        <v-tooltip bottom v-if="item._canConvert">
            <template v-slot:activator="{ on, attrs }">
                <v-icon x-small color="blue-grey" v-bind="attrs" v-on="on" class="ml-1">mdi-swap-horizontal</v-icon>
            </template>
            <span>C? th? quy ??i</span>
        </v-tooltip>
    </div>
</template>
                
                
                <template v-slot:item.amount="{ item }">
                    <div class="text-right">
                        <span class="font-weight-black" :class="{'red--text text--darken-2': item.amount &gt; 500000, 'deep-orange--text text--darken-2': item.amount &gt; 0 &amp;&amp; item.amount &lt;= 500000, 'grey--text': item.amount === 0}" style="font-size: 19px;">
                            {{ formatMoney(item.amount) }}
                        </span>
                        <span class="caption grey--text text--darken-1 ml-1" style="font-size: 13px;">?</span>
                    </div>
                </template>
                
                
                <template v-slot:item.hasPrice="{ item }">
                    <v-tooltip bottom v-if="item.amount === 0">
                        <template v-slot:activator="{ on, attrs }">
                            <v-icon color="red darken-2" v-bind="attrs" v-on="on" class="blink-animation">mdi-alert-circle</v-icon>
                        </template>
                        <span style="font-size: 14px;">L?i gi? 0?</span>
                    </v-tooltip>
                    <v-icon v-else color="green darken-2">mdi-check-circle</v-icon>
                </template>
                
                
                <template v-slot:item.dept="{ item }">
                    <span class="font-weight-black" :class="item.dept.includes('Kitchen') ? 'teal--text text--darken-3' : (item.dept.includes('Pizza') ? 'deep-orange--text text--darken-3' : (item.dept.includes('Service') ? 'blue--text text--darken-3' : 'purple--text text--darken-3'))" style="font-size: 16px;">
                        {{ item.dept }}
                    </span>
                </template>
                
                
                <template v-slot:item.note="{ item }">
                    <span class="grey--text text--darken-2 font-italic" style="font-size: 15px; font-weight: 500;">{{ item.note || '---' }}</span>
                </template>
            </v-data-table>
        </div>

    </div>
</v-tab-item>

<v-tab-item><div id="anchor-master-content" class="d-flex flex-column fill-height"><v-card class="rounded-0 elevation-1 px-3 py-2 white d-flex align-center" style="flex: 0 0 65px; z-index: 3; border-bottom: 1px solid #ddd;"><v-btn-toggle v-model="masterSubTab" mandatory dense class="mr-3 border" style="height: 40px;"><v-btn height="40" class="font-weight-bold teal--text text--darken-3" active-class="teal lighten-5">NVL</v-btn><v-btn height="40" class="font-weight-bold deep-orange--text text--darken-3" active-class="deep-orange lighten-5">SEMI</v-btn><v-btn height="40" class="font-weight-bold blue--text text--darken-3" active-class="blue lighten-5">PROD</v-btn></v-btn-toggle><template v-if="masterSubTab !== 1"><v-btn-toggle v-model="filterMasterDept" dense class="mr-3 border" style="height: 40px;"><v-btn value="Kit" height="40" class="font-weight-bold teal--text text--darken-3" active-class="teal lighten-5">KIT</v-btn><v-btn value="Pzz" height="40" class="font-weight-bold deep-orange--text text--darken-3" active-class="deep-orange lighten-5">PZZ</v-btn><v-btn value="Service" height="40" class="font-weight-bold blue--text text--darken-3" active-class="blue lighten-5">SVC</v-btn></v-btn-toggle><v-text-field v-model="searchMaster" placeholder="T?m M? / T?n..." outlined dense hide-details prepend-inner-icon="mdi-magnify" class="flex-grow-1 mr-3" style="font-size: 15px;"></v-text-field><v-btn depressed height="40" color="grey lighten-2" class="mr-2 black--text font-weight-bold" @click="dialogConfigCols=true"><v-icon left>mdi-table-cog</v-icon> C?t</v-btn></template><v-spacer v-else></v-spacer><v-btn color="purple darken-2" height="40" depressed dark class="font-weight-bold mr-3" @click="requestUpdateAllCosts"><v-icon left>mdi-calculator</v-icon> C?p Nh?t Gi? V?n</v-btn><v-btn color="deep-orange darken-1" height="40" depressed dark class="font-weight-bold mr-3" @click="dialogReplace.show=true"><v-icon left>mdi-swap-horizontal-bold</v-icon> Thay Th? NVL</v-btn><v-btn color="blue darken-3" height="40" depressed dark class="font-weight-bold mr-3" @click="dialogImportSales.show=true"><v-icon left>mdi-database-import</v-icon> Import Audit</v-btn><v-btn color="green darken-1" height="40" depressed dark class="font-weight-bold" @click="openMasterDialog('ADD')"><v-icon left>mdi-plus-circle</v-icon> Th?m M?i</v-btn></v-card><div v-if="masterSubTab !== 1" class="table-container-fixed" style="height: 100%"><v-data-table :headers="visibleMasterHeaders" :items="filteredMasterData" :loading="loading" fixed-header height="calc(100vh - 230px)" :items-per-page="50" class="elevation-0" :footer-props="{'items-per-page-options': [50, 100, 200, -1], 'show-current-page': true, 'show-first-last-page': true}" @dblclick:row="(e, row) =&gt; openMasterDialog('EDIT', row.item)" dense><template v-slot:item.action_edit="{ item }"><div class="d-flex justify-center align-center"><v-btn icon small color="blue darken-2" class="mr-3" @click="openMasterDialog('EDIT', item)" title="S?a"><v-icon small>mdi-pencil</v-icon></v-btn><v-btn icon small color="red lighten-1" @click="requestDeleteMaster(item)" title="X?a"><v-icon small>mdi-delete</v-icon></v-btn></div></template><template v-slot:item.code="{ item }"><div class="d-flex align-center" style="width: 100%; height: 100%;"><span class="code-text mr-3" style="font-size: 16px; color: #1565C0; min-width: 60px;">{{ item.code }}</span><span class="font-weight-black blue-grey--text text--darken-4 text-truncate" style="font-size: 16px; max-width: 300px;" :title="item.name">{{ item.name }}</span></div></template><template v-slot:item.team="{ item }"><v-chip v-if="item.sourceSheet" label class="font-weight-black" :color="item.sourceSheet.includes('Pzz') ? 'deep-orange darken-1' : (item.sourceSheet.includes('Service') ? 'blue darken-1' : 'teal darken-1')" text-color="white">{{ item.sourceSheet.includes('Pzz') ? 'PZZ' : (item.sourceSheet.includes('Service') ? 'SVC' : 'KIT') }}</v-chip><div v-else-if="item.team" class="font-weight-bold blue-grey--text text--darken-2" style="font-size: 14px;">{{ item.team }}</div></template><template v-slot:item.rate="{ item }"><div class="font-weight-bold text-center" style="font-size: 16px;">{{ item.rate }}</div></template><template v-slot:item.buyingPrice="{ item }"><div class="font-weight-bold text-right green--text text--darken-2" style="font-size: 16px;">{{ formatNumber(Math.round(item.buyingPrice || 0)) }}</div></template><template v-slot:item.buyingPrice="{ item }"><div class="font-weight-bold text-right green--text text--darken-2" style="font-size: 16px;">{{ formatNumber(Math.round(item.buyingPrice || 0)) }}</div></template><template v-slot:item.cost="{ item }"><div class="font-weight-bold deep-orange--text text--darken-2 text-right" style="font-size: 16px;">{{ formatNumber(Math.round(item.cost)) }}</div></template><template v-slot:item.unit="{ item }"><div class="font-weight-bold text-center" style="font-size: 16px;">{{ item.unit }}</div></template><template v-slot:item.actions="{ item }"><v-btn v-if="item.type!=='PROD'" icon color="deep-orange darken-2" class="mr-2" @click="traceUsage(item)" title="Xem n?i s? d?ng"><v-icon>mdi-text-search</v-icon></v-btn><v-btn icon color="purple darken-2" @click="openBOMEditor(item)" v-if="canHaveBOM(item)"><v-icon>mdi-sitemap</v-icon></v-btn></template></v-data-table></div><div v-else class="d-flex flex-grow-1" style="height: calc(100vh - 230px); overflow: hidden; background: #eee;"><div class="d-flex flex-column" style="width: 33.33%; height: 100%; border-right: 1px solid #ddd; background: #fff;"><div class="pa-2 teal lighten-5" style="border-bottom: 2px solid #00695C; flex-shrink: 0;"><div class="subtitle-2 font-weight-black teal--text text--darken-3 mb-1 text-center">KITCHEN ({{ semiDataKit.length }})</div><v-text-field v-model="searchSemiKit" placeholder="T?m..." outlined dense hide-details class="white" style="font-size: 13px;"></v-text-field></div><div style="flex-grow: 1; height: 100%; overflow: hidden;"><v-data-table :items="semiDataKit" :headers="headersSemi" fixed-header height="calc(100vh - 350px)" :items-per-page="-1" class="elevation-0" dense><template v-slot:item.code="{ item }"><div class="py-2 pointer" @dblclick="openBOMEditor(item)"><div class="code-text blue--text text--darken-2" style="font-size: 14px;">{{ item.code }}</div><div class="font-weight-bold blue-grey--text text--darken-4" style="font-size: 13px; line-height: 1.2;">{{ item.name }}</div></div></template><template v-slot:item.cost="{ item }"><span class="font-weight-bold deep-orange--text">{{ formatNumber(item.cost) }}</span></template><template v-slot:item.yield="{ item }"><span class="font-weight-bold black--text">{{ formatNumber(item.yield) }}</span></template><template v-slot:item.batchPrice="{ item }"><div class="font-weight-black teal--text text--darken-4 text-right" style="font-size: 14px;"> {{ formatNumber(getBatchPrice(item)) }} </div></template><template v-slot:item.unit="{ item }"><span class="font-weight-bold black--text">{{ item.unit }}</span></template><template v-slot:item.actions="{ item }"><div class="d-flex justify-end"><v-btn icon small color="deep-orange darken-2" class="mr-1" @click="traceUsage(item)" title="Truy v?t"><v-icon small>mdi-text-search</v-icon></v-btn><v-btn icon small color="blue darken-2" @click="openMasterDialog('EDIT', item)"><v-icon small>mdi-pencil</v-icon></v-btn><v-btn icon small color="red lighten-1" @click="requestDeleteMaster(item)"><v-icon small>mdi-delete</v-icon></v-btn></div></template></v-data-table></div></div><div class="d-flex flex-column" style="width: 33.33%; height: 100%; border-right: 1px solid #ddd; background: #fff;"><div class="pa-2 deep-orange lighten-5" style="border-bottom: 2px solid #D84315; flex-shrink: 0;"><div class="subtitle-2 font-weight-black deep-orange--text text--darken-3 mb-1 text-center">PIZZA ({{ semiDataPzz.length }})</div><v-text-field v-model="searchSemiPzz" placeholder="T?m..." outlined dense hide-details class="white" style="font-size: 13px;"></v-text-field></div><div style="flex-grow: 1; height: 100%; overflow: hidden;"><v-data-table :items="semiDataPzz" :headers="headersSemi" fixed-header height="calc(100vh - 350px)" :items-per-page="-1" class="elevation-0" dense><template v-slot:item.code="{ item }"><div class="py-2 pointer" @dblclick="openBOMEditor(item)"><div class="code-text blue--text text--darken-2" style="font-size: 14px;">{{ item.code }}</div><div class="font-weight-bold blue-grey--text text--darken-4" style="font-size: 13px; line-height: 1.2;">{{ item.name }}</div></div></template><template v-slot:item.cost="{ item }"><span class="font-weight-bold deep-orange--text">{{ formatNumber(item.cost) }}</span></template><template v-slot:item.yield="{ item }"><span class="font-weight-bold black--text">{{ formatNumber(item.yield) }}</span></template><template v-slot:item.batchPrice="{ item }"><div class="font-weight-black teal--text text--darken-4 text-right" style="font-size: 14px;"> {{ formatNumber(getBatchPrice(item)) }} </div></template><template v-slot:item.unit="{ item }"><span class="font-weight-bold black--text">{{ item.unit }}</span></template><template v-slot:item.actions="{ item }"><div class="d-flex justify-end"><v-btn icon small color="deep-orange darken-2" class="mr-1" @click="traceUsage(item)" title="Truy v?t"><v-icon small>mdi-text-search</v-icon></v-btn><v-btn icon small color="blue darken-2" @click="openMasterDialog('EDIT', item)"><v-icon small>mdi-pencil</v-icon></v-btn><v-btn icon small color="red lighten-1" @click="requestDeleteMaster(item)"><v-icon small>mdi-delete</v-icon></v-btn></div></template></v-data-table></div></div><div class="d-flex flex-column" style="width: 33.33%; height: 100%; background: #fff;"><div class="pa-2 blue lighten-5" style="border-bottom: 2px solid #1565C0; flex-shrink: 0;"><div class="subtitle-2 font-weight-black blue--text text--darken-3 mb-1 text-center">SERVICE ({{ semiDataSvc.length }})</div><v-text-field v-model="searchSemiSvc" placeholder="T?m..." outlined dense hide-details class="white" style="font-size: 13px;"></v-text-field></div><div style="flex-grow: 1; height: 100%; overflow: hidden;"><v-data-table :items="semiDataSvc" :headers="headersSemi" fixed-header height="calc(100vh - 350px)" :items-per-page="-1" class="elevation-0" dense><template v-slot:item.code="{ item }"><div class="py-2 pointer" @dblclick="openBOMEditor(item)"><div class="code-text blue--text text--darken-2" style="font-size: 14px;">{{ item.code }}</div><div class="font-weight-bold blue-grey--text text--darken-4" style="font-size: 13px; line-height: 1.2;">{{ item.name }}</div></div></template><template v-slot:item.cost="{ item }"><span class="font-weight-bold deep-orange--text">{{ formatNumber(item.cost) }}</span></template><template v-slot:item.yield="{ item }"><span class="font-weight-bold black--text">{{ formatNumber(item.yield) }}</span></template><template v-slot:item.batchPrice="{ item }"><div class="font-weight-black teal--text text--darken-4 text-right" style="font-size: 14px;"> {{ formatNumber(getBatchPrice(item)) }} </div></template><template v-slot:item.unit="{ item }"><span class="font-weight-bold black--text">{{ item.unit }}</span></template><template v-slot:item.actions="{ item }"><div class="d-flex justify-end"><v-btn icon small color="deep-orange darken-2" class="mr-1" @click="traceUsage(item)" title="Truy v?t"><v-icon small>mdi-text-search</v-icon></v-btn><v-btn icon small color="blue darken-2" @click="openMasterDialog('EDIT', item)"><v-icon small>mdi-pencil</v-icon></v-btn><v-btn icon small color="red lighten-1" @click="requestDeleteMaster(item)"><v-icon small>mdi-delete</v-icon></v-btn></div></template></v-data-table></div></div></div></div></v-tab-item>

<v-tab-item><div id="anchor-ai-content" class="d-flex flex-column fill-height"><v-card class="rounded-0 elevation-1 px-3 py-2 white d-flex align-center" style="flex: 0 0 65px; z-index: 3; border-bottom: 1px solid #ddd;"><v-btn-toggle v-model="activeMLTab" mandatory dense class="mr-3 border" style="height: 40px;"><v-btn height="40" class="font-weight-bold teal--text text--darken-3" active-class="teal lighten-5">NVL</v-btn><v-btn height="40" class="font-weight-bold deep-orange--text text--darken-3" active-class="deep-orange lighten-5">SEMI</v-btn><v-btn height="40" class="font-weight-bold blue--text text--darken-3" active-class="blue lighten-5">PROD</v-btn><v-btn height="40" class="font-weight-bold purple--text text--darken-3" active-class="purple lighten-5">TRANS</v-btn></v-btn-toggle><v-btn-toggle v-if="activeMLTab !== 3" v-model="mlFilterDept" dense class="mr-3 border" style="height: 40px;"><v-btn value="Kitchen" height="40" class="font-weight-bold teal--text text--darken-3" active-class="teal lighten-5">KIT</v-btn><v-btn value="Pizza" height="40" class="font-weight-bold deep-orange--text text--darken-3" active-class="deep-orange lighten-5">PZZ</v-btn><v-btn value="Service" height="40" class="font-weight-bold blue--text text--darken-3" active-class="blue lighten-5">SVC</v-btn></v-btn-toggle><v-autocomplete v-else v-model="mlFilterStore" :items="storeCodes" placeholder="Store..." outlined dense hide-details clearable style="width: 150px; max-width: 150px;" class="mr-3 font-weight-bold"></v-autocomplete><v-text-field v-model="mlFilterKw" placeholder="T?m t? kh?a..." outlined dense hide-details prepend-inner-icon="mdi-magnify" class="flex-grow-1" style="font-size: 15px;"></v-text-field></v-card><div class="table-container-fixed" style="height: 100%"><v-data-table :items="filteredMLData" :headers="headersML" fixed-header height="calc(100vh - 230px)" :items-per-page="50" class="elevation-0" :footer-props="{'items-per-page-options': [50, 100, 200, -1], 'show-current-page': true, 'show-first-last-page': true}"><template v-slot:item.actions="{ item }"><v-btn icon small color="blue darken-2" @click="openEditDialog(item, item.type)"><v-icon small>mdi-pencil</v-icon></v-btn></template><template v-slot:item.term="{ item }"><span class="font-weight-bold text-analyzed" style="font-size: 16px;">{{ item.term }}</span></template><template v-slot:item.context="{ item }"><v-chip v-if="item.type === 'ML_TRANS'" label color="purple lighten-5" class="purple--text text--darken-3">{{ item.context || 'M?i Store' }}</v-chip><span v-else>{{ item.context }}</span></template><template v-slot:item.code="{ item }"><div class="d-flex align-center py-1"><span class="code-text mr-2" style="font-size: 16px;">{{ item.code }}</span><span class="font-weight-bold blue-grey--text text--darken-4" style="font-size: 16px;">{{ item.name }}</span></div></template></v-data-table></div></div></v-tab-item>

<v-tab-item><div id="anchor-history-content" class="d-flex flex-column fill-height" style="background-color:#F5F5F5"><v-expand-transition><div v-show="showDashboard" class="pa-2 grey lighten-3"><v-row dense><v-col cols="6"><v-card outlined class="d-flex flex-column hover-card" style="border:1px solid #4CAF50;border-radius:8px;cursor:pointer" @click="applyQuickFilter('IN', null)"><div class="d-flex align-center justify-space-between px-4 py-2 green lighten-5" style="height:75px"><div class="d-flex align-center"><v-icon color="green darken-3" large class="mr-3">mdi-download-circle</v-icon><div class="d-flex flex-column"><span class="caption font-weight-black green--text text--darken-4 text-uppercase">H?NG THI?U (IN)</span><span class="display-1 font-weight-black green--text text--darken-4" style="line-height:1;font-family:'Roboto',sans-serif!important">{{formatNumber(historySummary.in)}}</span></div></div><div class="d-flex flex-column align-end justify-center" style="height:100%"><div class="caption font-weight-bold grey--text text--darken-2 mb-1">T?ng: <span class="font-weight-black">{{historySummary.countIn}}</span> phi?u</div><div style="font-size:13px;background:white;padding:4px 8px;border-radius:4px;border:1px solid #C8E6C9" class="font-weight-bold elevation-1"><span class="teal--text text--darken-3 hover-text" @click.stop="applyQuickFilter('IN','Kitchen')">KIT: {{historySummary.kitIn}}</span> <span class="grey--text lighten-1 mx-1">|</span> <span class="deep-orange--text text--darken-3 hover-text" @click.stop="applyQuickFilter('IN','Pizza')">PZZ: {{historySummary.pzzIn}}</span> <span class="grey--text lighten-1 mx-1">|</span> <span class="blue--text text--darken-3 hover-text" @click.stop="applyQuickFilter('IN','Service')">SVC: {{historySummary.svcIn}}</span></div></div></div><v-divider></v-divider><div class="pa-0 white" style="height:210px;overflow:hidden"><div v-for="(i,x) in historySummary.topIn" :key="x" class="d-flex align-center justify-space-between py-2 px-3 hover-item" style="border-bottom:1px solid #f0f0f0;height:42px"><div class="d-flex align-center text-truncate" style="flex:1;gap:8px"><span class="subtitle-2 font-weight-bold grey--text text--darken-4 text-truncate" :title="i.name">{{i.name}}</span><v-chip x-small color="green lighten-5" class="px-1 font-weight-bold green--text text--darken-3">{{i.freq}} l?n</v-chip><span class="caption font-weight-bold grey--text text--darken-1 text-truncate" :title="i.storeStr"><v-icon x-small color="grey lighten-1" class="mr-1">mdi-store</v-icon>{{i.storeStr}}</span></div><div class="subtitle-2 font-weight-black green--text text--darken-3 ml-2 text-right" style="min-width:90px">{{formatNumber(i.val)}}<span class="caption grey--text ml-1" style="font-size:10px">{{dashboardMode==='QTY'?i.unit:'?'}}</span></div></div></div></v-card></v-col><v-col cols="6"><v-card outlined class="d-flex flex-column hover-card" style="border:1px solid #FF5722;border-radius:8px;cursor:pointer" @click="applyQuickFilter('OUT', null)"><div class="d-flex align-center justify-space-between px-4 py-2 deep-orange lighten-5" style="height:75px"><div class="d-flex align-center"><v-icon color="deep-orange darken-3" large class="mr-3">mdi-upload-circle</v-icon><div class="d-flex flex-column"><span class="caption font-weight-black deep-orange--text text--darken-4 text-uppercase">H?NG D? (OUT)</span><span class="display-1 font-weight-black deep-orange--text text--darken-4" style="line-height:1;font-family:'Roboto',sans-serif!important">{{formatNumber(historySummary.out)}}</span></div></div><div class="d-flex flex-column align-end justify-center" style="height:100%"><div class="caption font-weight-bold grey--text text--darken-2 mb-1">T?ng: <span class="font-weight-black">{{historySummary.countOut}}</span> phi?u</div><div style="font-size:13px;background:white;padding:4px 8px;border-radius:4px;border:1px solid #FFCCBC" class="font-weight-bold elevation-1"><span class="teal--text text--darken-3 hover-text" @click.stop="applyQuickFilter('OUT','Kitchen')">KIT: {{historySummary.kitOut}}</span> <span class="grey--text lighten-1 mx-1">|</span> <span class="deep-orange--text text--darken-3 hover-text" @click.stop="applyQuickFilter('OUT','Pizza')">PZZ: {{historySummary.pzzOut}}</span> <span class="grey--text lighten-1 mx-1">|</span> <span class="blue--text text--darken-3 hover-text" @click.stop="applyQuickFilter('OUT','Service')">SVC: {{historySummary.svcOut}}</span></div></div></div><v-divider></v-divider><div class="pa-0 white" style="height:210px;overflow:hidden"><div v-for="(i,x) in historySummary.topOut" :key="x" class="d-flex align-center justify-space-between py-2 px-3 hover-item" style="border-bottom:1px solid #f0f0f0;height:42px"><div class="d-flex align-center text-truncate" style="flex:1;gap:8px"><span class="subtitle-2 font-weight-bold grey--text text--darken-4 text-truncate" :title="i.name">{{i.name}}</span><v-chip x-small color="deep-orange lighten-5" class="px-1 font-weight-bold deep-orange--text text--darken-3">{{i.freq}} l?n</v-chip><span class="caption font-weight-bold grey--text text--darken-1 text-truncate" :title="i.storeStr"><v-icon x-small color="grey lighten-1" class="mr-1">mdi-arrow-right-bold</v-icon>{{i.storeStr}}</span></div><div class="subtitle-2 font-weight-black deep-orange--text text--darken-3 ml-2 text-right" style="min-width:90px">{{formatNumber(i.val)}}<span class="caption grey--text ml-1" style="font-size:10px">{{dashboardMode==='QTY'?i.unit:'?'}}</span></div></div></div></v-card></v-col></v-row></div></v-expand-transition><div class="d-flex flex-column flex-grow-1" style="overflow:hidden"><v-card class="rounded-0 elevation-1 px-3 py-2 white d-flex align-center flex-shrink-0" style="flex:0 0 50px;z-index:3;border-bottom:1px solid #ddd"><v-btn icon small class="mr-2 d-md-none" @click="drawer=!drawer"><v-icon>mdi-menu</v-icon></v-btn><v-btn v-if="!showDashboard" icon small color="blue darken-3" class="mr-2" @click="showDashboard=true" title="Hi?n Dashboard"><v-icon>mdi-view-dashboard</v-icon></v-btn><v-btn v-else icon small color="grey darken-2" class="mr-2" @click="showDashboard=false" title="?n Dashboard"><v-icon>mdi-chevron-up</v-icon></v-btn><v-btn-toggle v-model="dashboardMode" mandatory dense rounded class="mr-3 elevation-1 border"><v-btn value="QTY" x-small class="font-weight-bold" active-class="blue-grey darken-3 white--text">SL</v-btn><v-btn value="AMT" x-small class="font-weight-bold" active-class="deep-orange darken-3 white--text">$</v-btn></v-btn-toggle><v-btn-toggle v-model="filterTeam" dense class="mr-3 border" style="height:32px"><v-btn :value="null" height="32" class="font-weight-bold grey--text text--darken-3 caption" active-class="grey lighten-2">ALL</v-btn><v-btn value="Kitchen" height="32" class="font-weight-bold teal--text text--darken-3 caption" active-class="teal lighten-5">KIT</v-btn><v-btn value="Pizza" height="32" class="font-weight-bold deep-orange--text text--darken-3 caption" active-class="deep-orange lighten-5">PZZ</v-btn><v-btn value="Service" height="32" class="font-weight-bold blue--text text--darken-3 caption" active-class="blue lighten-5">SVC</v-btn></v-btn-toggle><v-btn-toggle v-model="historyFilterStatus" dense class="mr-3 border" style="height:32px" mandatory><v-tooltip bottom><template v-slot:activator="{on,attrs}"><v-btn value="ALL" height="32" v-bind="attrs" v-on="on"><v-icon small color="blue-grey">mdi-filter-variant</v-icon></v-btn></template><span>T?t c?</span></v-tooltip><v-tooltip bottom><template v-slot:activator="{on,attrs}"><v-btn :value="true" height="32" active-class="green lighten-5" v-bind="attrs" v-on="on"><v-icon small color="green darken-2">mdi-check-circle</v-icon></v-btn></template><span>?? xong</span></v-tooltip><v-tooltip bottom><template v-slot:activator="{on,attrs}"><v-btn :value="false" height="32" active-class="grey lighten-4" v-bind="attrs" v-on="on"><v-icon small color="grey darken-1">mdi-checkbox-blank-circle-outline</v-icon></v-btn></template><span>Ch?a xong</span></v-tooltip></v-btn-toggle><v-menu ref="menuDate" offset-y :close-on-content-click="false"><template v-slot:activator="{on,attrs}"><v-btn depressed outlined color="blue-grey darken-1" v-bind="attrs" v-on="on" class="mr-3 font-weight-bold caption" height="32">{{historyFromDate}} <v-icon x-small class="mx-1">mdi-arrow-right</v-icon> {{historyToDate}}</v-btn></template><v-card class="pa-3"><v-row dense><v-col cols="6"><v-text-field v-model="historyFromDate" type="date" label="T?" outlined dense></v-text-field></v-col><v-col cols="6"><v-text-field v-model="historyToDate" type="date" label="??n" outlined dense></v-text-field></v-col></v-row></v-card></v-menu><v-btn-toggle v-model="filterType" dense class="mr-3 border" style="height:32px"><v-btn :value="null" height="32" class="font-weight-bold grey--text text--darken-3 caption" active-class="grey lighten-2">ALL</v-btn><v-btn value="IN" height="32" class="font-weight-bold green--text text--darken-3 caption" active-class="green lighten-5">IN</v-btn><v-btn value="OUT" height="32" class="font-weight-bold deep-orange--text text--darken-3 caption" active-class="deep-orange lighten-5">OUT</v-btn></v-btn-toggle><v-autocomplete v-model="filterStoreLocation" :items="storeCodes" placeholder="Ch?n Store..." outlined dense hide-details style="width:150px;max-width:150px" class="mr-3 font-weight-bold caption" clearable prepend-inner-icon="mdi-store" height="32"></v-autocomplete><v-text-field v-model="historySearchInput" @input="debounceSearch" placeholder="T?m..." outlined dense hide-details prepend-inner-icon="mdi-magnify" class="flex-grow-1 mr-2 caption" style="font-size:13px" height="32"></v-text-field><v-tooltip bottom><template v-slot:activator="{on,attrs}"><v-btn small color="white" light class="mr-2 elevation-1" height="32" @click="dialogWidthConfig=true" v-bind="attrs" v-on="on"><v-icon small color="blue-grey darken-2">mdi-ruler</v-icon></v-btn></template><span>C?u h?nh ?? r?ng</span></v-tooltip><v-scale-transition><v-btn v-if="modifiedHistoryCount&gt;0" color="red darken-1" dark depressed height="32" class="font-weight-bold px-4 animate-pulse mr-2 caption" @click="saveModifiedHistoryRows"><v-icon left small>mdi-content-save-alert</v-icon> L?U {{modifiedHistoryCount}}</v-btn></v-scale-transition><v-menu offset-y :close-on-content-click="false"><template v-slot:activator="{on,attrs}"><v-btn small color="white" light class="mr-2 elevation-1 font-weight-bold caption" v-bind="attrs" v-on="on" height="32"><v-icon left small>mdi-view-column</v-icon> C?t</v-btn></template><v-list dense style="max-height:400px;overflow-y:auto"><v-list-item v-for="(header,index) in allHistoryHeaders" :key="index"><v-checkbox v-model="header.show" :label="header.text" dense hide-details class="mt-0"></v-checkbox></v-list-item></v-list></v-menu><v-btn icon small color="blue-grey" @click="loadSystemData" title="L?m m?i"><v-icon small>mdi-refresh</v-icon></v-btn></v-card><div class="flex-grow-1" style="overflow:hidden"><v-data-table :headers="visibleHistoryHeaders" :items="filteredHistoryData" fixed-header height="calc(100vh - 145px)" class="elevation-0 history-table" :items-per-page="100" :item-class="rowClassHistory" :footer-props="{'items-per-page-options':[50,100,200,-1],'show-current-page':true,'show-first-last-page':true}" ref="historyTable" :key="tableRenderKey"><template v-slot:item.actions_edit="{item}"><v-btn icon small color="blue darken-2" @click="openHistoryEdit(item)"><v-icon small>mdi-pencil</v-icon></v-btn></template><template v-slot:item.status="{item}"><v-icon :color="item.status?'green':'grey lighten-2'" @click="toggleHistoryStatus(item)">{{item.status?'mdi-check-circle':'mdi-checkbox-blank-circle-outline'}}</v-icon></template><template v-slot:item.team="{item}"><v-chip v-if="item.team" label class="font-weight-black" :color="item.team.toLowerCase().includes('kitchen')?'teal darken-1':(item.team.toLowerCase().includes('pizza')?'deep-orange darken-1':'blue darken-1')" text-color="white">{{item.team}}</v-chip></template><template v-slot:item.type="{item}"><span class="font-weight-black" :class="String(item.type).toUpperCase()==='IN'?'green--text text--darken-3':'deep-orange--text text--darken-3'">{{item.type}}</span></template><template v-slot:item.sender="{item}"><div class="d-flex align-center font-weight-bold black--text text-truncate" style="font-size:14px;max-width:100%"><span class="text-truncate">{{item.sender?item.sender.split(' ')[0]:'Unknown'}}</span><v-icon x-small class="mx-1 flex-shrink-0" color="grey darken-1">mdi-arrow-right-bold</v-icon><span class="text-truncate">{{item.realReceiver||(item.receiver?item.receiver.split(' ')[0]:'?')}}</span></div></template><template v-slot:item.rate="{item}"><div v-if="item.rate&gt;1" class="d-flex align-center justify-center"><v-chip x-small label class="px-1 mr-1" :color="item.rateState===1?'green lighten-4':'grey lighten-4'" :class="{'green--text text--darken-4 font-weight-black':item.rateState===1,'grey--text':item.rateState!==1}" style="border:1px solid #C8E6C9;cursor:pointer" @click="setRateMode(item,1)">x</v-chip><span class="caption font-weight-bold grey--text text--darken-2" style="min-width:25px;text-align:center">{{item.rate}}</span><v-chip x-small label class="px-1 ml-1" :color="item.rateState===2?'deep-orange lighten-4':'grey lighten-4'" :class="{'deep-orange--text text--darken-4 font-weight-black':item.rateState===2,'grey--text':item.rateState!==2}" style="border:1px solid #FFCCBC;cursor:pointer" @click="setRateMode(item,2)">/</v-chip></div><span v-else class="grey--text lighten-2" style="font-size:20px">&mdash;</span></template><template v-slot:item.code="{item}"><div class="d-flex align-center" style="height:100%;width:100%"><span class="code-text mr-3" style="font-size:16px;color:#1565C0;min-width:60px">{{item.code}}</span><span class="font-weight-black blue-grey--text text--darken-4 text-truncate" style="font-size:16px" :title="item.name">{{item.name}}</span></div></template><template v-slot:item.amount="{item}"><span class="black--text font-weight-bold" style="font-size:15px">{{formatNumber(item.amount)}}</span></template><template v-slot:item.itemName="{item}"><div class="subtitle-2 font-weight-bold black--text text-truncate" :title="item.itemName">{{item.itemName}}</div><div class="caption red--text font-weight-bold" v-if="item.note">{{item.note}}</div></template></v-data-table></div></div></v-tab-item>


</v-tabs-items>